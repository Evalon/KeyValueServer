'use strict';var _extends=Object.assign||function(a){for(var c,b=1;b<arguments.length;b++)for(var d in c=arguments[b],c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d]);return a};(function(){function a(x){var y=document.querySelector('.result');!y.firstChild?y.appendChild(x):y.insertBefore(x,y.firstChild)}function b(x){if(x.ok)return x;throw x.statusText}function c(x,y){a(f(x,null,y))}function d(x,y){a(f(x,y))}function f(x,y,z){function A(F,G){var H=document.createElement('span');return H.classList.add('result__command-name','result__'+G),H.appendChild(document.createTextNode(F)),H}function B(F,G,H){function I(L,M){function N(P,Q){var R=document.createElement('span'),S=document.createTextNode(P);return R.classList.add('key-value__'+Q),R.appendChild(S),R}var O=document.createElement('div');return O.classList.add('key-value'),!L||O.appendChild(N(L,'key')),null!==M&&O.appendChild(N(M,'value')),O}var J=document.createElement('div');if(J.classList.add('result__element'),J.appendChild(A(F,H)),!G)J.appendChild(document.createTextNode('List is empty'));else if(1==G.length)J.appendChild(I(G[0].key,G[0].value));else{var K=document.createElement('ul');K.classList.add('result__list'),G.forEach(function(L){var M=document.createElement('li');M.classList.add('result__list-element'),M.appendChild(I(L.key,L.value)),K.appendChild(M)}),J.appendChild(K)}return J}function C(F,G,H,I){return B(F,[{key:G,value:H}],I)}function D(F,G,H){var I=document.createElement('div');I.classList.add('result__element','result__element_error'),I.appendChild(A(F,H));var J=document.createElement('span');return J.appendChild(document.createTextNode(G)),I.appendChild(J),I}var E=JSON.parse(x.body);switch(E.type){case q.CREATE:return z?D('Create',z,'create'):C('Create',E.key,E.value,'create');case q.READ:return z?D('Read key',z,'read'):C('Read key',E.key,y.result,'read');case q.READALL:return z?D('Read all',z,'read-all'):B('Read all',y.result.map(function(F){return{key:F,value:null}}),'read-all');case q.UPDATE:return z?D('Update',z,'update'):C('Update',E.key,E.value,'update');case q.DELETE:return z?D('Delete',z,'delete'):C('Delete',E.key,null,'update');}}function g(x){var y=x;('GET'===x.method||'HEAD'==x.method)&&(y=_extends({},x,{body:null})),fetch(encodeURI(t+x.url),y).then(function(z){return z.json().then(function(A){if(z.ok)return A;throw{fromJson:A.errorMessage}}).catch(function(A){throw A.fromJson||z.statusText})}).then(function(z){return d(x,z)}).catch(function(z){return c(x,z)})}function h(x,y){var z=x;('GET'===x.method||'HEAD'==x.method)&&(z=_extends({},x,{body:null})),fetch(t+x.url,z).then(b).then(function(A){return A.json()}).then(function(A){for(var B=0;B<y.length;B++)0===A[B].status?d(y[B],A[B]):c(y[B],A[B].errorMessage)}).catch(function(A){return y.forEach(function(B){return c(B,A)})})}function j(x){s.push(x)}var q={CREATE:0,READ:1,READALL:2,UPDATE:3,DELETE:4,AGGREGATE:5},r=!1,s=[],t='api/keyvalue',u=document.querySelector('.main__input.main__input_key'),v=document.querySelector('.main__input.main__input_value');var w='click';document.querySelector('.actions__create').addEventListener(w,function(){var y={url:'/',method:'POST',body:JSON.stringify({type:q.CREATE,key:u.value,value:v.value}),headers:{Accept:'application/json','Content-Type':'application/json'}};r?j(y):g(y)}),document.querySelector('.actions__get').addEventListener(w,function(){var y={url:'/'+encodeURIComponent(u.value),method:'GET',body:JSON.stringify({type:q.READ,key:u.value}),headers:{Accept:'application/json','Content-Type':'application/json'}};return''===u.value?c(y,'No key provided'):void(r?j(y):g(y))}),document.querySelector('.actions__getall').addEventListener(w,function(){var y={url:'/',method:'GET',body:JSON.stringify({type:q.READALL,key:u.value}),headers:{Accept:'application/json','Content-Type':'application/json'}};r?j(y):g(y)}),document.querySelector('.actions__update').addEventListener(w,function(){var y={url:'/'+encodeURIComponent(u.value),method:'PUT',body:JSON.stringify({type:q.UPDATE,key:u.value,value:v.value}),headers:{Accept:'application/json','Content-Type':'application/json'}};r?j(y):g(y)}),document.querySelector('.actions__delete').addEventListener(w,function(){var y={url:'/'+encodeURIComponent(u.value),method:'DELETE',body:JSON.stringify({type:q.DELETE,key:u.value}),headers:{Accept:'application/json','Content-Type':'application/json'}};r?j(y):g(y)}),document.querySelector('.actions__transaction').addEventListener(w,function(x){var y={url:'-actions',method:'POST',body:JSON.stringify(s.map(function(z){return JSON.parse(z.body)})),headers:{Accept:'application/json','Content-Type':'application/json'}};r&&0<s.length&&h(y,s),s=[],r=!r,x.target.classList.toggle('actions__transaction_active'),x.target.textContent=r?'End transaction':'Start transaction'})})();